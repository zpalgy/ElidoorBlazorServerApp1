@using BlazorServerApp1.Pages
@using BlazorServerApp1.Data

@page "/Configurator3"
@inherits Configurator3Base

@inject IJSRuntime Js

<style>
    th, td {
        padding: 15px;
        text-align: center;
    }
</style>

<h3>Configurator3</h3>



<div id="divHeader" dir="rtl" style="border: solid; border-color: black; border-radius: 10px">
    <table id="tblLine1">
        <tr>
            <th>תאריך</th>
            <th>שם ממלא שאלון</th>
            <th>אסמכתא</th>
        </tr>
        <tr>
            <td>
                <input type="date" name="txtDate" @bind="formDate" />
                @code {
                    public DoorConfig? doorConfig; // = new DoorConfig();

                    private DateTime _formDate = DateTime.Now;
                    protected DateTime formDate
                    {
                        get { return _formDate; }
                        set
                        {
                            _formDate = value;
                            if (doorConfig == null)
                                doorConfig = new DoorConfig();
                            doorConfig.FORMDATE = _formDate.ToString("dd/MM/yyyy");
                        }
                    }
                }
            </td>
            <td>
                <input name="txtFormFiller" @bind="formFiller" dir="rtl" />
                @code {
                    protected string _formFiller;
                    protected string formFiller
                    {
                        get { return _formFiller; }
                        set
                        {
                            _formFiller = value;
                            if (doorConfig != null)
                                doorConfig.FORMFILLER = _formFiller;
                        }
                    }
                }
            </td>
            <td>
                <input name="txtReference" @bind="reference" @ref="txtReference"/>
                @code {

                    private ElementReference txtReference;
                    protected string _reference;
                    protected string reference
                    {
                        get { return _reference; }
                        set
                        {
                            _reference = value;

                            if (doorConfig != null)
                                if (!string.IsNullOrEmpty(PrApiCalls.getReference(_reference, ref errMsg)))
                                {
                                //UiLogic.displayErrMsg(lblMsgL1, "אסמכתא עם מספר זה כבר קיימת במערכת");
                                    //
                                    //return;
                                    Js.InvokeVoidAsync("alert", "אסמכתא עם מספר זה כבר קיימת במערכת");
                                    txtReference.FocusAsync();


                                }
                            else
                                doorConfig.REFERENCE = _reference;
                        }
                    }
                }
            </td>
            <td>
                <label id="lblMsgL1" />
            </td>
        </tr>
    </table>

    @code {
        protected override async Task OnInitializedAsync()
        {
            doorConfig = new DoorConfig();
            formDate = DateTime.Now;
            //doorConfig.FORMDATE = formDate.ToString("dd/MM/yyyy");
            //doorConfig.FORMFILLER = "aaaaaaaaaaaaaaa";
            await ProtectedSessionStore.SetAsync("doorConfig", doorConfig);
        }

        public async Task SaveDoorConfig()
        {
            if (doorConfig != null)
                await ProtectedSessionStore.SetAsync("doorConfig", doorConfig);
        }

        public async Task GetDoorConfig()
        {
            var result = await ProtectedSessionStore.GetAsync<DoorConfig>("doorConfig");
            doorConfig = result.Success ? result.Value : null;
        }

        public async Task DeleteDoorConfigFromSession()
        {
            await ProtectedSessionStore.DeleteAsync("doorConfig");
        }
    }

    <table id="tblLine2">
        <tr>
            <th>שם משווק</th>
            <th>שם לקוח קצה</th>
            <th>כתובת</th>
            <th>כתובת לאספקה</th>
        </tr>
        <tr>
            <td>
                <select name="dlstAgent" @bind="AGENT">
                    @if (lstAgents != null)
                    {
                        @foreach (AGENT_Class a in lstAgents)
                        {
                            <option value="@a.AGENT">@a.AGENTNAME</option>
                        }
                    }
                </select>
            </td>
            <td>
                <select name="dlstCustDes" @bind="CUST">
                    @if (lstCustomers != null)
                    {
                        @foreach (CUSTOMER_Class c in lstCustomers)
                        {
                            <option value="@c.CUST">@c.CUSTDES</option>
                        }
                    }
                </select> />
            </td>
            <td>
                <input dir="rtl" />
            </td>
            <td>
                <input dir="rtl" />
            </td>
        </tr>
    </table>
    <table id="tblProducts">
        <tr>
            <td>
                <button name="btnDoor" @onclick="btnDoorClicked">דלת</button>
                @code
                {
                    private void btnDoorClicked()
                    {
                        hideDivDoor = false;
                    }
                }
            </td>
            <td>
                <button name="btnLintel">משקוף</button>
            </td>
            <td>
                <button name="btnCover">חיפוי</button>
            </td>
            <td>
                <button name="btnSideUnit">יחידת צד</button>
            </td>
            <td>
                <button name="btnECabinet">ארון חשמל</button>
            </td>
            <td>
                <button name="btnShelves">מדפים</button>
            </td>
        </tr>
    </table>
</div>
<!--end of divHeader -->
@code {
    //public DoorConfig doorConfig = new DoorConfig();
    private string _CUST = string.Empty;
    protected string CUST
    {
        get { return _CUST; }
        set
        {
            _CUST = value;
            if (doorConfig != null)
                doorConfig.CUST = int.Parse(_CUST);
        }
    }
    private int _AGENT = 0;
    protected int AGENT
    {
        get { return _AGENT; }
        set
        {
            _AGENT = value;
            if (doorConfig != null)
                doorConfig.AGENT = _AGENT;
        }
    }
    //protected bool hideCustDes { get; set; } = false;
    protected static string errMsg = string.Empty;
    protected List<CUSTOMER_Class>? lstCustomers = PrApiCalls.getCustomers(ref errMsg);
    protected List<AGENT_Class>? lstAgents = PrApiCalls.getAgents(ref errMsg);
    int x = 17;
    //BlazorServerApp1.Pages.Configurator3
    protected bool hideDivDoor = true;
    }

<div id="divDoor" dir="rtl" hidden="@hideDivDoor">

    <div id="divDoorTitle" dir="rtl" style="border: solid; border-color: black; border-radius: 10px">
        <table id="tblDoorTitle">
            <tr>
                <th id="thWingsNum">מיפתח</th>
                <th id="thOpenMode">צורת פתיחה</th>
                <th id="thComplient">דלת תואם אלידור</th>
                <th id="thPARTNAME">דגם</th>
                <th id="thFamily">סידרה</th>
            </tr>
            <tr>
                <td>
                    <select name="dlstWingsNum">
                        <option>בחר סוג מיפתח</option>
                        <option>כנף</option>
                        <option>כנף וחצי</option>
                        <option>דו כנפי</option>
                    </select>
                </td>
                <td>
                    <select name="dlstOpenMode">
                        <option>בחר צורת פתיחה</option>
                        <option>החוצה</option>
                        <option>פנימה</option>
                    </select>
                </td>

                <td>
                    <input type="checkbox" name="chkbComplient" />
                </td>
                <td>
                    <select name="dlstPARTNAME">
                    </select>
                </td>
                <td>
                    <input name="txtFAMILY" Enabled="false" />
                </td>

            </tr>
        </table>
    </div>
    <!-- end divDoorTitle -->


    <br />
    <br />
    <br />

    @code {
        // tab control here -
        // tab content pages in separate *.razor files
        // ref: https://blazor-university.com/templating-components-with-renderfragements/creating-a-tabcontrol/
    }

    <TabControl>
        <TabPage Text="כנף נעה">
            <Movingwing doorConfig="@doorConfig"></Movingwing>
        </TabPage>
        <TabPage Text="Tab 2">
            <Counter />
        </TabPage>
        <TabPage Text="Tab 3">
            <h1>The third tab</h1>
        </TabPage>
    </TabControl>

</div>
<!-- end divDoor -->



